{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nconst initialState = {\n  repos: [],\n  selectedRepo: null,\n  sortField: null,\n  sortOrder: 'asc',\n  loading: false,\n  error: null\n};\nexport const fetchRepos = createAsyncThunk('repos/fetchRepos', async query => {\n  const response = await axios.get(`https://api.github.com/search/repositories?q=${query}`);\n  return response.data.items;\n});\nconst repoSlice = createSlice({\n  name: 'repos',\n  initialState,\n  reducers: {\n    setSelectedRepo(state, action) {\n      state.selectedRepo = action.payload;\n    },\n    setSortField(state, action) {\n      if (state.sortField === action.payload) {\n        // Если щелкаем по текущему столбцу, меняем направление сортировки\n        state.sortOrder = state.sortOrder === 'asc' ? 'desc' : 'asc';\n      } else {\n        // Если щелкаем по новому столбцу, сбрасываем направление на 'asc'\n        state.sortField = action.payload;\n        state.sortOrder = 'asc';\n      }\n    },\n    setSortOrder(state, action) {\n      state.sortOrder = action.payload;\n    },\n    sortRepos(state) {\n      if (state.sortField) {\n        state.repos = state.repos.slice().sort((a, b) => {\n          const fieldA = a[state.sortField];\n          const fieldB = b[state.sortField];\n          if (typeof fieldA === 'number' && typeof fieldB === 'number') {\n            return state.sortOrder === 'asc' ? fieldA - fieldB : fieldB - fieldA;\n          } else if (typeof fieldA === 'string' && typeof fieldB === 'string') {\n            return state.sortOrder === 'asc' ? fieldA.localeCompare(fieldB) : fieldB.localeCompare(fieldA);\n          } else {\n            return 0;\n          }\n        });\n      }\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchRepos.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchRepos.fulfilled, (state, action) => {\n      state.loading = false;\n      state.repos = action.payload;\n      // Применить сортировку после загрузки\n      if (state.sortField) {\n        repoSlice.caseReducers.sortRepos(state);\n      }\n    }).addCase(fetchRepos.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.error.message || 'Failed to fetch repositories';\n    });\n  }\n});\nexport const {\n  setSelectedRepo,\n  setSortField,\n  setSortOrder,\n  sortRepos\n} = repoSlice.actions;\nexport default repoSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","initialState","repos","selectedRepo","sortField","sortOrder","loading","error","fetchRepos","query","response","get","data","items","repoSlice","name","reducers","setSelectedRepo","state","action","payload","setSortField","setSortOrder","sortRepos","slice","sort","a","b","fieldA","fieldB","localeCompare","extraReducers","builder","addCase","pending","fulfilled","caseReducers","rejected","message","actions","reducer"],"sources":["/Users/aleksandr/github-repo-search/src/redux/repoSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport axios from 'axios';\n\nexport interface Repo {\n  id: number;\n  name: string;\n  language: string;\n  forks_count: number;\n  stargazers_count: number;\n  updated_at: string;\n  description: string;\n  license: {\n    name: string;\n  } | null;\n}\n\ninterface RepoState {\n  repos: Repo[];\n  selectedRepo: Repo | null;\n  sortField: keyof Repo | null;\n  sortOrder: 'asc' | 'desc';\n  loading: boolean;\n  error: string | null;\n}\n\nconst initialState: RepoState = {\n  repos: [],\n  selectedRepo: null,\n  sortField: null,\n  sortOrder: 'asc',\n  loading: false,\n  error: null,\n};\n\nexport const fetchRepos = createAsyncThunk(\n  'repos/fetchRepos',\n  async (query: string) => {\n    const response = await axios.get(`https://api.github.com/search/repositories?q=${query}`);\n    return response.data.items as Repo[];\n  }\n);\n\nconst repoSlice = createSlice({\n  name: 'repos',\n  initialState,\n  reducers: {\n    setSelectedRepo(state, action: PayloadAction<Repo>) {\n      state.selectedRepo = action.payload;\n    },\n    setSortField(state, action: PayloadAction<keyof Repo>) {\n      if (state.sortField === action.payload) {\n        // Если щелкаем по текущему столбцу, меняем направление сортировки\n        state.sortOrder = state.sortOrder === 'asc' ? 'desc' : 'asc';\n      } else {\n        // Если щелкаем по новому столбцу, сбрасываем направление на 'asc'\n        state.sortField = action.payload;\n        state.sortOrder = 'asc';\n      }\n    },\n    setSortOrder(state, action: PayloadAction<'asc' | 'desc'>) {\n      state.sortOrder = action.payload;\n    },\n    sortRepos(state) {\n      if (state.sortField) {\n        state.repos = state.repos.slice().sort((a, b) => {\n          const fieldA = a[state.sortField!];\n          const fieldB = b[state.sortField!];\n\n          if (typeof fieldA === 'number' && typeof fieldB === 'number') {\n            return state.sortOrder === 'asc' ? fieldA - fieldB : fieldB - fieldA;\n          } else if (typeof fieldA === 'string' && typeof fieldB === 'string') {\n            return state.sortOrder === 'asc'\n              ? fieldA.localeCompare(fieldB)\n              : fieldB.localeCompare(fieldA);\n          } else {\n            return 0;\n          }\n        });\n      }\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchRepos.pending, (state) => {\n        state.loading = true;\n        state.error = null;\n      })\n      .addCase(fetchRepos.fulfilled, (state, action) => {\n        state.loading = false;\n        state.repos = action.payload;\n        // Применить сортировку после загрузки\n        if (state.sortField) {\n          repoSlice.caseReducers.sortRepos(state);\n        }\n      })\n      .addCase(fetchRepos.rejected, (state, action) => {\n        state.loading = false;\n        state.error = action.error.message || 'Failed to fetch repositories';\n      });\n  },\n});\n\nexport const { setSelectedRepo, setSortField, setSortOrder, sortRepos } = repoSlice.actions;\n\nexport default repoSlice.reducer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}